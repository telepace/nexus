# 测试工具目录

此目录包含后端测试所需的各种工具函数和辅助类。

## 主要工具

### test_db.py

提供测试数据库隔离机制，确保测试不会影响真实数据库。主要功能：

- 创建和管理测试专用数据库（基于主数据库名称 + `_test` 后缀）
- 自动创建所有表结构（使用 SQLModel.metadata.create_all()）
- 测试后清理和删除测试数据库

### user.py

提供用户相关的测试辅助函数：

- 随机用户数据生成
- 获取认证令牌
- 其他用户操作相关工具

### utils.py

通用测试辅助工具：

- 随机字符串生成
- 超级用户令牌获取
- API 响应处理

## 设计原则

1. **隔离性**：测试环境完全与开发/生产环境隔离
2. **自动化**：测试环境自动设置和清理
3. **可靠性**：确保测试结果的一致性和可重复性
4. **安全性**：不影响真实数据，不留下测试数据残留

## 使用说明

大多数工具函数由 `conftest.py` 中的 fixtures 自动调用，无需手动使用。但如果需要，也可以在测试中直接导入和使用这些工具。

例如，创建随机用户数据：

```python
from app.tests.utils.user import create_random_user
from app.tests.utils.utils import random_email, random_lower_string

# 创建随机用户
user = create_random_user(db)
```

## 扩展

如需添加新的测试工具，请遵循以下原则：

1. 相关功能按模块分组
2. 提供清晰的函数文档
3. 确保工具函数不依赖于真实环境
4. 所有自动化工具应支持清理操作 