# 📜 页面脚本（Content Script）说明指南

## 🤔 什么是"页面脚本"？

**页面脚本（Content Script）** 是 Nexus 扩展的核心组件，它的作用是：

```
🌐 普通网页 + 📜 页面脚本 = 🔗 智能网页
```

### 📖 通俗解释

想象一下：
- **网页** = 一本书 📚
- **页面脚本** = 一个智能助手 🤖
- **扩展** = 你的笔记本 📝

页面脚本就像是一个**隐形的智能助手**，它：
- 📖 **读取**网页内容（标题、正文、链接等）
- 🔍 **分析**页面结构和类型
- 📤 **传递**信息给 Nexus 扩展
- 💾 **响应**保存、分析等操作

## 🚨 为什么会显示"页面脚本未加载"？

### 原因分析

这个问题通常在以下情况出现：

1. **扩展刚安装** 🆕
   - 你安装扩展时，浏览器里已经打开了一些网页
   - 这些"老"网页没有安装页面脚本
   - 就像给房子装了智能家居，但之前的电器还没连接

2. **页面权限限制** 🔒
   - 某些特殊页面（如 chrome:// 设置页）不允许注入脚本
   - 这是浏览器的安全机制

3. **网络或加载问题** 🌐
   - 页面加载过程中脚本注入失败
   - 网络不稳定导致脚本加载中断

## ✅ 解决方案（从简单到高级）

### 🔥 方法 1：刷新页面（推荐）
**最简单有效的解决方案**

```
按 F5 或 Ctrl+R（Windows）/ Cmd+R（Mac）刷新页面
```

**原理**：页面重新加载时，扩展会自动注入页面脚本

### 🤖 方法 2：自动修复（v0.1.1 新增）
**Nexus 会尝试自动解决**

当检测到脚本未加载时：
1. 显示"🔄 正在注入页面脚本，请稍候..."
2. 自动尝试注入脚本
3. 成功后显示"✅ 页面脚本注入成功！"

### 🔄 方法 3：重新加载扩展
**如果问题持续出现**

1. 打开 `chrome://extensions/`
2. 找到 Nexus 扩展
3. 点击"刷新"图标 🔄
4. 回到网页，扩展会自动处理所有已打开的标签页

### 🆕 方法 4：打开新标签页
**临时解决方案**

在新标签页中打开相同网址，新页面会自动加载页面脚本。

## 🎯 不同页面类型的处理

| 页面类型 | 支持状态 | 说明 |
|----------|----------|------|
| 🌐 普通网站 | ✅ 完全支持 | 新闻、博客、社交媒体等 |
| 🔒 Chrome设置页 | ❌ 不支持 | `chrome://` 开头的页面 |
| 🏠 新标签页 | ❌ 不支持 | 空白或书签页面 |
| 📁 本地文件 | ⚠️ 部分支持 | 需要特殊权限 |
| 🔐 HTTPS 网站 | ✅ 完全支持 | 安全网站 |

## 🔧 高级排查

### 检查脚本状态
在任意网页打开浏览器控制台（F12），运行：

```javascript
// 检查页面脚本是否已加载
chrome.runtime.sendMessage({type: 'PING'}, (response) => {
  if (chrome.runtime.lastError) {
    console.log('❌ 页面脚本未加载');
  } else {
    console.log('✅ 页面脚本正常：', response);
  }
});
```

### 手动注入脚本
```javascript
// 手动注入页面脚本（需要开发者权限）
chrome.tabs.query({active: true, currentWindow: true}, (tabs) => {
  chrome.scripting.executeScript({
    target: { tabId: tabs[0].id },
    files: ['page-observer.1f0e3a13.js']
  });
});
```

## 📋 常见问题 FAQ

### Q: 为什么新打开的页面正常，老页面有问题？
A: 扩展的页面脚本只对**新加载的页面**自动生效。已打开的页面需要刷新或手动注入。

### Q: 刷新页面会丢失我的工作吗？
A: 大多数现代网站都有自动保存功能。如果担心，可以：
- 先保存当前工作
- 或在新标签页中打开相同网址

### Q: 为什么有些页面永远无法使用扩展？
A: 出于安全考虑，浏览器禁止扩展访问：
- 浏览器设置页面（chrome://）
- 扩展管理页面
- 某些银行或支付网站

### Q: 扩展会影响网页加载速度吗？
A: 页面脚本非常轻量级（<10KB），对页面性能影响微乎其微。

## 🛡️ 隐私与安全

### 页面脚本的权限
- ✅ 只读取页面**公开内容**（标题、正文等）
- ✅ **不访问**密码、表单输入
- ✅ **不修改**页面内容或样式
- ✅ 所有数据处理都在**本地**进行

### 数据安全
- 🔒 页面内容仅在需要时才发送到你的 Nexus 服务器
- 🔒 传输过程使用加密连接
- 🔒 不会收集个人敏感信息

## 💡 最佳实践

1. **安装扩展后**：刷新所有重要的标签页
2. **遇到问题时**：先尝试刷新页面
3. **特殊页面**：了解哪些页面无法使用扩展
4. **定期更新**：保持扩展为最新版本

---

💬 **还有问题？** 查看扩展的调试功能或联系技术支持。 